<launch>
  <arg name='role_name' default='ego_vehicle'/>
  <arg name='wheelbase' default='2.7'/>

  <!--
    ##################
    ## TF remapping ##
    ##################
  -->
  <!-- world to map tf -->
  <node pkg='tf2_ros'  type='static_transform_publisher' name='world_to_map' args='0 0 0 0 0 0 /world /map' />

  <!-- map to mobility tf -->
  <node pkg='tf2_ros'  type='static_transform_publisher' name='map_to_mobility' args='0 0 0 0 0 0 /map /mobility' />

  <!-- ego_vehicle to base_link tf -->
  <!-- Disabled as it gets published by ndt_matching -->
  <!--<node pkg='tf2_ros'  type='static_transform_publisher' name='$(arg role_name)_to_baselink' args='0 0 0 0 0 0 $(arg role_name) /base_link' />-->

  <!-- ego_vehicle/gnss to gps tf -->
  <node pkg='tf2_ros'  type='static_transform_publisher' name='$(arg role_name)gnss_to_gps' args='0 0 0 0 0 0 $(arg role_name)/gnss/gnss1 /gps' />

  <!-- ego_vehicle/lidar to velodyne tf -->
  <node pkg='tf2_ros'  type='static_transform_publisher' name='$(arg role_name)lidar_to_velodyne' args='0 0 0 0 0 0 $(arg role_name)/lidar/lidar1 /velodyne' />

  <!-- ego_vehicle/cameraFront to camera tf -->
  <node pkg='tf2_ros'  type='static_transform_publisher' name='$(arg role_name)camerafront_to_camera' args='0 0 0 0 0 0 $(arg role_name)/camera/rgb/front /camera' />

  <!--
    #############################################
    ## topic remapping + data type conversions ##
    #############################################
  -->
  <!--
    # lidar #
    remap carla lidar to autoware.
    @todo: to reduce load, Autoware should directly use the Carla-topic.
  -->
  <node pkg='topic_tools' type='relay' name='points_relay' args='/carla/$(arg role_name)/lidar/lidar1/point_cloud /points_raw'/>

  <!--
    # camera #
    remap carla front camera to autoware
    @todo: to reduce load, Autoware should directly use the Carla-topic.
  -->
  <node pkg='topic_tools' type='relay' name='imag_relay' args='/carla/$(arg role_name)/camera/rgb/front/image_color /image_raw'/>
  <node pkg='topic_tools' type='relay' name='info_relay' args='/carla/$(arg role_name)/camera/rgb/front/camera_info /camera_info'/>

  <!--
    # gnss #
    Extract the pose from the carla odometry.
    Disable this if Autoware should calculate its pose from gnss (see my_localization.launch)
  -->
  <node pkg='carla_autoware_bridge' type='odometry_to_posestamped' name='odometry_to_posestamped'/>

  <!-- convert twist to carla ackermann drive-->
  <node pkg='carla_autoware_bridge' type='vehiclecmd_to_ackermanndrive' name='vehiclecmd_to_ackermanndrive' output='screen'>
    <param name='wheelbase' value='$(arg wheelbase)'/>
  </node>

  <!-- convert the vehicle status from carla to autoware -->
  <node pkg='carla_autoware_bridge' type='carla_to_autoware_vehicle_status' name='carla_to_autoware_vehicle_status' output='screen'/>










  <!-- convert waypoint path to autoware lane_array -->
  <node pkg="carla_autoware_bridge" type="carla_to_autoware_waypoints" name="carla_to_autoware_waypoints" output="screen"/>

  <!--
    # ACTUATOR #
    convert ackermann control to carla vehicle control (with PID controller)
  -->
  <include file="$(find carla_ackermann_control)/launch/carla_ackermann_control.launch">
    <arg name='role_name' value='$(arg role_name)'/>
  </include>

</launch>
